## 2PC与3PC

### 2PC
	二阶段提交，Two-Phase commit；
- 阶段一 投票阶段
	- 事务询问；向所有参与者发送事务内容，询问是否可以执行事务提价哦操作，并开始等待各参与者的响应
	- 执行事务，各参与者执行事务操作，记录undo和redo日志
	- 各参与者向协调者反馈事务询问的响应；如果参与者成功执行了事务，就反馈给协调者成功；否则返回失败；
- 阶段二
	- 发送提交请求，协调者向所有参与者节点发送commit
	- 事务提交，参与者接受到commit后，正式提交事务
	- 参与者反馈事务提交结果
	- 完成事务：协调者接收到所有参与者返回的消息，完成事务
- 中断事务：如果有一个参与者向协调者发送失败返回，或者等待超时，协调者就会中断事务
	- 发送回滚请求；向所有参与者节点发出rollback请求
	- 事务回滚：参与者收到rollback信号，使用undo日志进行事务回滚，完成之后释放资源
	- 反馈事务回滚结果，参与者完成事务回滚，返回消息
	- 中断事务，协调者收到反馈，完成事务中断

#### 优缺点
- 优点
	- 原理简单、实现简单
- 缺点
	- 同步阻塞、单点问题、脑裂、太过保守

同步阻塞：二阶段提交的执行过程中，所有参与者都处于阻塞状态
单点问题：协调者在阶段二中出现问题，其他参与者将会处于锁定资源等待的状态，无法得到提交事务或者回滚的通知
数据不一致：阶段二提交事务时，协调者通知参与者提交事务时，由于网络或者协调者崩溃导致只有部分参与者收到提交信号，就会导致数据不一致；
太过保守：协调者通知参与者提交事务后，参与者出现故障导致协调者无法收到成功响应，这时协调者就只能根据自身超时机制判断是否需要中断事务；这种策略比较保守。

### 3PC
- CanCommit
	- 事务询问：协调者向参与者发送包含事务内容的canCommit请求，询问是否可以执行事务
	- 参与者向协调者反馈响应

- PreCommit，在阶段二中，协调者根据各参与者反馈决定是佛铏事务的preCommit操作
	- 执行事务预提交：所有参与者返回yes响应
		- 发送预提交请求，协调者向所有参与者发送preCommit请求，进入Prepared阶段
		- 事务预提交：参与者接收到preCommit，会执行事务操作，记录undo和redo信息
		- 各参与者向协调者反馈执行事务的结果，成功或者失败
	- 中断事务：如果某一个参与者向协调者反馈了失败响应，或者等待参与者反馈超时，协调者就会中断事务
		- 发送中断请求：协调者向多有的参与者节点发出abort请求
		- 中断事务：无论是收到协调者的abort指令或者时等待协调者超时，参与者都会中断事务

- doCommit，真正执行事务提交；有以下两种情况
	- 执行提交：
		- 发送提交请求：协调者收到来自所有参与者的成功响应，就会从预提交状态转换到提交状态，并向所有的参与者发送doCommit请求
		- 事务提交：参与者接收到doCommit请求后，会正式执行事务提交操作
		- 反馈事务提交结果：参与者在完成事务提交之后，向协调者反馈
		- 完成事务：协调者接收到所有参与者反馈的消息后，完成事务
	- 中断事务：任意一个参与者反回了失败或者等待参与者响应超时 ；就会中断事务
		- 发送中断请求：协调者向所有参与者发送abort请求
		- 事务回滚：参与者接受到abort请求后，使用undo信息来执行事务回滚操作；
		- 反馈事务回滚结果：参与者在完成事务回滚之后，向协调者进行反馈
		- 中断事务：协调者接收到所有参与者反馈的消息，中断事务

#### 优缺点
- 优点：相较于2PC，降低了参与者的阻塞范围，出现单点故障后可以继续达成一致
- 缺点：3PC同样存在数据不一致问题

## Paxos算法



